<!-- templates/matching/_employer_matches_cards.html -->
<!-- تم التعديل: دعم عرض السير الذاتية المرفوعة والمبنية مع ملف التعريف -->
{% load i18n custom_filters %}
{% for item in matches %}
<div class="col-md-6 col-lg-4 mb-4">
    <div class="card match-card h-100 border-left-{{ item.match.color_class }} shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <div>
                <h5 class="card-title mb-0">
                    {% if item.resume.candidate.first_name %}
                        {{ item.resume.candidate.first_name }} {{ item.resume.candidate.last_name }}
                    {% else %}
                        {{ item.resume.candidate.username }}
                    {% endif %}
                </h5>
                <small class="text-muted">
                    {% if item.profile %}
                        {% trans "Primary Resume" %}: 
                        {% if item.type == 'built' %}
                            <span class="badge badge-success">{% trans "Built Resume" %}</span>
                        {% else %}
                            <span class="badge badge-info">{% trans "Uploaded Resume" %}</span>
                        {% endif %}
                        {% if item.profile.has_both_resumes %}
                            <span class="badge badge-secondary ml-1">{% trans "Has Both" %}</span>
                        {% endif %}
                    {% else %}
                        {% if item.type == 'built' %}
                            <span class="badge badge-success">{% trans "Built Resume" %}</span>
                        {% else %}
                            <span class="badge badge-info">{% trans "Uploaded Resume" %}</span>
                        {% endif %}
                    {% endif %}
                </small>
            </div>
            <div class="text-right">
                <div class="h4 mb-0">
                    <span class="badge badge-{{ item.match.color_class|default:'secondary' }} badge-lg">
                        {{ item.match.score|floatformat:0 }}%
                    </span>
                </div>
                <small class="text-muted">
                    {% trans "Match Score" %}
                </small>
            </div>
        </div>
        
        <div class="card-body">
            <div class="mb-3">
                <h6 class="text-primary mb-2">
                    <i class="fas fa-briefcase mr-1"></i>
                    {% trans "Applied for" %}: {{ item.job.title }}
                </h6>
                <p class="text-muted small mb-2">
                    <i class="fas fa-building mr-1"></i>{{ item.job.company }}
                </p>
            </div>
            
            <!-- معلومات السيرة الذاتية -->
            <div class="mb-3">
                <h6 class="text-secondary mb-2">
                    {% trans "Resume Details" %}
                </h6>
                <p class="mb-1">
                    <strong>{% trans "Title" %}:</strong> 
                    {% if item.resume|get_resume_title %}
                        {{ item.resume|get_resume_title }}
                    {% else %}
                        {% trans "Not specified" %}
                    {% endif %}
                </p>
                
                {% if item.profile %}
                    <p class="mb-1">
                        <strong>{% trans "Contact" %}:</strong> 
                        {{ item.resume.candidate.email }}
                    </p>
                    {% if item.resume.candidate.phone %}
                        <p class="mb-1">
                            <strong>{% trans "Phone" %}:</strong> 
                            {{ item.resume.candidate.phone }}
                        </p>
                    {% endif %}
                {% endif %}
            </div>
            
            <!-- أسباب المطابقة -->
            {% if item.match.reasons %}
            <div class="mb-3">
                <h6 class="text-success mb-2">
                    <i class="fas fa-check-circle mr-1"></i>
                    {% trans "Match Reasons" %}
                </h6>
                <ul class="list-unstyled small mb-0">
                    {% for reason in item.match.reasons %}
                    <li class="mb-1">
                        <i class="fas fa-check text-success mr-1"></i>
                        {{ reason }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- نقاط القوة -->
            {% if item.match.strengths %}
            <div class="mb-3">
                <h6 class="text-info mb-2">
                    <i class="fas fa-star mr-1"></i>
                    {% trans "Strengths" %}
                </h6>
                <div class="d-flex flex-wrap gap-1">
                    {% for strength in item.match.strengths %}
                    <span class="badge badge-info">{{ strength }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- نقاط الضعف -->
            {% if item.match.weaknesses %}
            <div class="mb-3">
                <h6 class="text-warning mb-2">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    {% trans "Areas for Improvement" %}
                </h6>
                <div class="d-flex flex-wrap gap-1">
                    {% for weakness in item.match.weaknesses %}
                    <span class="badge badge-warning">{{ weakness }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="card-footer bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group" role="group">
                    <a href="{% url 'matching:match_detail' job_id=item.job.id resume_id=item.resume.id %}" 
                       class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-chart-line mr-1"></i>
                        {% trans "Full Analysis" %}
                    </a>
                    
                    <!-- روابط السير الذاتية -->
                    {% if item.profile %}
                        {% if item.profile.uploaded_resume %}
                        <a href="{{ item.profile.get_uploaded_resume_url }}" 
                           class="btn btn-sm btn-outline-info" target="_blank">
                            <i class="fas fa-file-upload mr-1"></i>
                            {% trans "View Uploaded" %}
                        </a>
                        {% endif %}
                        
                        {% if item.profile.built_resume %}
                        <a href="{{ item.profile.get_built_resume_url }}" 
                           class="btn btn-sm btn-outline-success">
                            <i class="fas fa-edit mr-1"></i>
                            {% trans "View Built" %}
                        </a>
                        {% endif %}
                    {% else %}
                        <a href="{{ item.resume|get_resume_url }}" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye mr-1"></i>
                            {% trans "View Resume" %}
                        </a>
                    {% endif %}
                </div>
                
                <small class="text-muted">
                    {% if item.resume.created_at %}
                        {{ item.resume.created_at|time_ago }}
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="col-12">
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <h5>{% trans "No matches found" %}</h5>
        <p class="mb-0">{% trans "No candidates match your criteria at this time." %}</p>
    </div>
</div>
{% endfor %}