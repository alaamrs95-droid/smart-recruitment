<!-- templates/matching/resume_jobs_matches.html -->
{% extends 'base/base.html' %}
{% load static i18n %}

{% block title %}
{% trans "Job Matches for Resume" %} - {{ resume.original_filename }}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card mt-3">

                <!-- Header -->
                <div class="card-header d-flex justify-content-end align-items-center">
                    <span class="badge badge-info badge-pill mr-1">
                        {% trans "Total Jobs:" %} {{ total_jobs }}
                    </span>
                    <span class="badge badge-success badge-pill mr-2">
                        {% trans "Matched:" %} {{ matched_jobs }}
                    </span>
                    <a href="{% url 'resumes:detail' pk=resume.id %}"
                       class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i>
                        {% trans "Back to Resume" %}
                    </a>
                </div>

                <div class="card-body">

                    {# ================= TOP 10 MATCHES ================= #}
                    {% if top_matches %}
                    <div class="mb-5">

                        <h4 class="text-warning mb-2">
                            <i class="fas fa-star"></i>
                            {% trans "Top 10 AI Matches" %}
                        </h4>

                        <p class="text-muted mb-4">
                            {% trans "Best opportunities selected by AI based on your resume" %}
                        </p>

                        <div class="row">
                            {% include "matching/_matches_cards.html"
                               with matches=top_matches resume=resume %}
                        </div>

                    </div>
                    <hr class="my-4">
                    {% endif %}

                    {# ================= ALL MATCHES ================= #}
                    <h3 class="mb-4">
                        <i class="fas fa-brain"></i>
                        {% trans "AI Job Matches for" %} "{{ resume.original_filename }}"
                    </h3>

                    {% if matches %}
                    <div class="row">
                        {% for item in matches %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 border-left-{{ item.match.color_class }}">

                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <a href="{% url 'jobs:detail' pk=item.job.id %}">
                                            {{ item.job.title }}
                                        </a>
                                    </h5>
                                    <small class="text-muted">
                                        {{ item.job.employer.username }}
                                    </small>
                                </div>

                                <div class="card-body">

                                    <strong>{% trans "Match Score:" %}</strong>
                                    <span class="badge badge-{{ item.match.color_class }} badge-pill ml-1">
                                        {{ item.match.label }}
                                    </span>

                                    <div class="progress mb-3 mt-2" style="height: 1.4rem;">
                                        <div class="progress-bar bg-{{ item.match.color_class }}"
                                             role="progressbar"
                                             style="width: {{ item.match.score }}%;"
                                             aria-valuenow="{{ item.match.score }}"
                                             aria-valuemin="0"
                                             aria-valuemax="100">
                                            {{ item.match.score }}%
                                        </div>
                                    </div>

                                    {% if item.match.strengths %}
                                    <strong>{% trans "Your Strengths:" %}</strong>
                                    <ul class="list-unstyled text-success">
                                        {% for strength in item.match.strengths %}
                                        <li>
                                            <i class="fas fa-check"></i>
                                            {{ strength }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}

                                    {% if item.match.weaknesses %}
                                    <strong>{% trans "Areas to Improve:" %}</strong>
                                    <ul class="list-unstyled text-danger">
                                        {% for weakness in item.match.weaknesses %}
                                        <li>
                                            <i class="fas fa-times"></i>
                                            {{ weakness }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>

                                <div class="card-footer text-center">
                                    <a href="{% url 'matching:match_detail'
                                        resume_id=resume.id job_id=item.job.id %}"
                                       class="btn btn-sm btn-info">
                                        {% trans "Full Analysis" %}
                                    </a>
                                    <a href="{% url 'jobs:detail' pk=item.job.id %}"
                                       class="btn btn-sm btn-primary">
                                        {% trans "View Job" %}
                                    </a>
                                </div>

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <p class="text-muted lead">
                            {% trans "No matching jobs found for this resume." %}
                        </p>
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .progress {
        border-radius: 0.5rem;
    }

    .card:hover {
        transform: translateY(-5px);
        transition: 0.2s;
    }

    /* دعم border-left حسب score */
    .border-left-success {
        border-left: 5px solid #28a745 !important;
    }

    .border-left-warning {
        border-left: 5px solid #ffc107 !important;
    }

    .border-left-danger {
        border-left: 5px solid #dc3545 !important;
    }
</style>
{% endblock %}
