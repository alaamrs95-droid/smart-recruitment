<!-- templates/matching/_matches_cards.html -->
<!-- تم التعديل: دعم عرض السير الذاتية المرفوعة والمبنية -->
{% load i18n custom_filters %}
{% for item in matches %}
<div class="col-md-6 col-lg-4 mb-4">
    <div class="card match-card h-100 border-left-{{ item.match.color_class }} shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <div>
                <h5 class="card-title mb-0">
                    <a href="{% url 'jobs:detail' pk=item.job.id %}" class="text-decoration-none">
                        <i class="fas fa-briefcase mr-2"></i>{{ item.job.title|truncatechars:30 }}
                    </a>
                </h5>
                <small class="text-muted">
                    <i class="fas fa-building mr-1"></i>{{ item.job.employer.username }}
                    {% if item.job.created_at %}
                    <span class="mx-2">•</span>
                    <i class="fas fa-clock mr-1"></i>{{ item.job.created_at|date:"M d, Y" }}
                    {% endif %}
                </small>
                <!-- تم الإضافة: عرض نوع السيرة الذاتية -->
                {% if item.resume|has_attr:'original_filename' %}
                <div class="mt-1">
                    <span class="badge badge-info badge-pill">
                        <i class="fas fa-file-upload mr-1"></i>{% trans "Uploaded Resume" %}
                    </span>
                    <small class="text-muted">{{ item.resume.original_filename|truncatechars:20 }}</small>
                </div>
                {% elif item.resume|has_attr:'title' %}
                <div class="mt-1">
                    <span class="badge badge-success badge-pill">
                        <i class="fas fa-edit mr-1"></i>{% trans "Built Resume" %}
                    </span>
                    <small class="text-muted">{{ item.resume.title|truncatechars:20 }}</small>
                </div>
                {% endif %}
            </div>
            <div class="text-left">
                {% if item.match.score >= 80 %}
                <span class="badge badge-success badge-pill p-2">
                    <i class="fas fa-star mr-1"></i>{% trans "Excellent" %}
                </span>
                {% elif item.match.score >= 60 %}
                <span class="badge badge-warning badge-pill p-2">
                    <i class="fas fa-thumbs-up mr-1"></i>{% trans "Good" %}
                </span>
                {% else %}
                <span class="badge badge-secondary badge-pill p-2">
                    <i class="fas fa-info-circle mr-1"></i>{% trans "Moderate" %}
                </span>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <strong class="text-dark">{% trans "Match Score:" %}</strong>
                    <span class="font-weight-bold {{ item.match.color_class }}">{{ item.match.score }}%</span>
                </div>
                <div class="progress" style="height: 1rem; border-radius: 0.5rem;">
                    <div class="progress-bar bg-{{ item.match.color_class }} progress-bar-striped" 
                         style="width: {{ item.match.score }}%" 
                         role="progressbar" 
                         aria-valuenow="{{ item.match.score }}" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                    </div>
                </div>
            </div>
            
            {% if item.match.reasons %}
            <div class="mb-3">
                <strong class="text-dark d-block mb-2">
                    <i class="fas fa-lightbulb text-warning mr-2"></i>{% trans "Why this match?" %}
                </strong>
                <div class="bg-light rounded p-2">
                    {% for reason in item.match.reasons %}
                    <div class="small mb-1">
                        <i class="fas fa-check-circle text-success mr-2"></i>{{ reason }}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if item.match.strengths %}
            <div class="mb-3">
                <strong class="text-dark d-block mb-2">
                    <i class="fas fa-plus-circle text-success mr-2"></i>{% trans "Strengths:" %}
                </strong>
                <div class="row">
                    {% for strength in item.match.strengths %}
                    <div class="col-12 mb-1">
                        <span class="badge badge-success badge-pill mr-1 mb-1">
                            <i class="fas fa-check mr-1"></i>{{ strength|truncatechars:25 }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if item.match.weaknesses %}
            <div class="mb-3">
                <strong class="text-dark d-block mb-2">
                    <i class="fas fa-exclamation-triangle text-warning mr-2"></i>{% trans "Areas for Improvement:" %}
                </strong>
                <div class="row">
                    {% for weakness in item.match.weaknesses %}
                    <div class="col-12 mb-1">
                        <span class="badge badge-warning badge-pill mr-1 mb-1">
                            <i class="fas fa-info mr-1"></i>{{ weakness|truncatechars:25 }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        <div class="card-footer bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    {% if resume and resume.id %}
                    <a href="{% url 'matching:match_detail' resume_id=resume.id job_id=item.job.id %}" 
                       class="btn btn-sm btn-info" 
                       data-toggle="tooltip" 
                       title="{% trans 'View detailed AI analysis' %}">
                        <i class="fas fa-chart-line mr-1"></i>{% trans "Analysis" %}
                    </a>
                    {% else %}
                    <span class="btn btn-sm btn-secondary disabled" 
                          data-toggle="tooltip" 
                          title="{% trans 'Upload a resume to enable analysis' %}">
                        <i class="fas fa-chart-line mr-1"></i>{% trans "No Analysis" %}
                    </span>
                    {% endif %}
                </div>
                <div>
                    <a href="{% url 'jobs:detail' pk=item.job.id %}" 
                       class="btn btn-sm btn-primary" 
                       data-toggle="tooltip" 
                       title="{% trans 'View full job details' %}">
                        <i class="fas fa-briefcase mr-1"></i>{% trans "Job" %}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="col-12 text-center py-5">
    <p class="text-muted">{% trans "No matches in this category." %}</p>
</div>
{% endfor %}
